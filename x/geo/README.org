#+TITLE: Geo Module
#+BEGIN_SRC go :tangle types.go :exports none
  // GENERATED FROM README.org
  // DO NOT EDIT THIS FILE DIRECTLY!!!!!
  package geo

  import (
    sdk "github.com/cosmos/cosmos-sdk/types"
  )
#+END_SRC
* Overview
  The `geo` module provides an efficient storage space for on-chain geographic features that can be referenced by other modules.
* Motivation and Rationale
  While geographic features could be stored as literals everywhere they are needed, precise measurements of real world objects like a polygon that describes an irregularly shaped field can become quite large because of the number of points required to be precise. Having a single storage space for these objects reduces overall storage requirements. Geographic features are also referenced by hash on-chain which provides for content addressability and reduces duplication.
* Transaction Messages and Types
** Store geographic feature on-chain
#+BEGIN_SRC go :tangle types.go
  type MsgStoreGeo struct {
    Data Geometry `json:"data"`
    Signer sdk.AccAddress `json:"signer"`
  }

  type FeatureType int

  const (
    Point FeatureType = 0
    LineString
    Polygon
    MultiPoint
    MultiLineString
    MultiPolygon
  )

  type Geometry struct {
    Type FeatureType `json:"type"`
    // EWKB representation of the geo feature. Must be in the WGS84 coordinate
    // system and represent a Point, LineString, Polygon, MultiPoint, MultiLineString or MultiPolygon
    EWKB []byte `json:"ewkb,omitempty"`
  }
#+END_SRC

** Identifiers
*** Stored `GeoFeature`
    Stored `GeoFeature's are referenced by the identifier `xrn://<block-hash>/<hash>` where `<hash>` is the bech32 encoding with prefix `geo` of the Blake2b 256-bit hash of the EWKB representation of the geographic feature.
** Indexing and Queries
   Geographic features are indexed by both the Postgis and RDF indexers.
*** Postgis
#+BEGIN_SRC sql :tangle geo.sql
  CREATE TABLE geo (
    hash bytea NOT NULL PRIMARY KEY,
    tx bytea NOT NULL REFERENCES tx,
    -- Both the Postgis geography and geometry representations are stored
    geog geography NOT NULL,
    geom geometry NOT NULL
  );

  CREATE INDEX geo_geom_gist ON geo USING GIST ( geom );
#+END_SRC
*** RDF
#+BEGIN_SRC turtle
PREFIX geo: <http://www.opengis.net/ont/geosparql#>
PREFIX sf: <http://www.opengis.net/ont/sf#>

<xrn://1234/geosghj38sdgh358>
  a sf:Point ;
  geo:asWKT "Point(-83.38 33.95)"^^<geo:wktLiteral> .
#+END_SRC
